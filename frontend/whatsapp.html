<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üí¨ PizzaMaster Pro ‚Äî Central WhatsApp</title>
<link href="https://fonts.googleapis.com/css2?family=Abril+Fatface&family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
:root {
  --primary:#FF4500; --accent:#FFD700;
  --bg:#0F0F0F; --bg2:#1A1A1A; --bg3:#242424;
  --card:#1E1E1E; --border:#2D2D2D;
  --text:#F0F0F0; --muted:#888;
  --wa:#25D366; --wa-dark:#128C7E; --wa-bg:#0D1117;
  --radius:12px;
}
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Nunito',sans-serif; background:var(--bg); color:var(--text); }

/* TOP BAR */
.topbar {
  background:var(--bg2); border-bottom:1px solid var(--border);
  padding:16px 28px; display:flex; align-items:center; justify-content:space-between;
}
.topbar-brand { display:flex; align-items:center; gap:12px; }
.topbar-brand h1 { font-family:'Abril Fatface',serif; color:var(--wa); font-size:1.3rem; }
.topbar-brand small { color:var(--muted); display:block; font-size:0.75rem; }
.wa-status { display:flex; align-items:center; gap:8px; }
.wa-dot { width:10px; height:10px; background:var(--wa); border-radius:50%; animation:pulse 2s infinite; }
@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }
.wa-status-text { font-size:0.82rem; font-weight:700; color:var(--wa); }

/* LAYOUT */
.layout { display:grid; grid-template-columns:320px 1fr 340px; gap:0; height:calc(100vh - 65px); }

/* ‚îÄ‚îÄ CONTACTS PANEL ‚îÄ‚îÄ */
.contacts-panel {
  background:var(--bg2); border-right:1px solid var(--border);
  display:flex; flex-direction:column; overflow:hidden;
}
.cp-header { padding:16px; border-bottom:1px solid var(--border); }
.cp-header h3 { font-weight:800; font-size:0.95rem; margin-bottom:10px; }
.cp-search {
  background:var(--bg3); border:1px solid var(--border); border-radius:8px;
  padding:8px 12px; color:var(--text); font-family:'Nunito',sans-serif;
  font-size:0.85rem; outline:none; width:100%; transition:border 0.2s;
}
.cp-search:focus { border-color:var(--wa); }
.cp-tabs { display:flex; border-bottom:1px solid var(--border); }
.cp-tab {
  flex:1; padding:10px; text-align:center;
  font-weight:700; font-size:0.78rem; cursor:pointer;
  border-bottom:2px solid transparent; transition:all 0.2s; color:var(--muted);
}
.cp-tab.active { color:var(--wa); border-bottom-color:var(--wa); }
.contacts-list { flex:1; overflow-y:auto; }

.contact-item {
  display:flex; align-items:center; gap:12px;
  padding:12px 16px; border-bottom:1px solid rgba(255,255,255,0.04);
  cursor:pointer; transition:background 0.2s;
}
.contact-item:hover { background:var(--bg3); }
.contact-item.active { background:rgba(37,211,102,0.08); border-left:3px solid var(--wa); }

.ca-avatar {
  width:44px; height:44px; border-radius:50%;
  display:flex; align-items:center; justify-content:center;
  font-weight:900; font-size:0.9rem; flex-shrink:0;
}
.ca-info { flex:1; min-width:0; }
.ca-name { font-weight:800; font-size:0.9rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.ca-last { font-size:0.75rem; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.ca-meta { text-align:right; flex-shrink:0; }
.ca-time { font-size:0.68rem; color:var(--muted); display:block; margin-bottom:4px; }
.ca-badge {
  background:var(--wa); color:white;
  font-size:0.65rem; font-weight:800;
  padding:2px 7px; border-radius:20px;
  display:inline-block;
}
.ca-status { font-size:0.65rem; font-weight:700; padding:2px 8px; border-radius:20px; }
.status-enviado { background:rgba(33,150,243,0.2); color:#42A5F5; }
.status-entregue { background:rgba(37,211,102,0.2); color:var(--wa); }
.status-aberto { background:rgba(255,109,0,0.2); color:#FFA040; }

/* ‚îÄ‚îÄ CHAT PANEL ‚îÄ‚îÄ */
.chat-panel {
  background:var(--wa-bg);
  display:flex; flex-direction:column;
  position:relative;
}
.chat-panel::before {
  content:'';
  position:absolute; inset:0;
  background-image:url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.02'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
  pointer-events:none;
}

.chat-header {
  background:rgba(37,211,102,0.1); border-bottom:1px solid rgba(37,211,102,0.2);
  padding:14px 20px; display:flex; align-items:center; gap:14px; position:relative; z-index:1;
}
.ch-avatar {
  width:42px; height:42px; border-radius:50%;
  display:flex; align-items:center; justify-content:center;
  font-weight:900; font-size:0.9rem;
}
.ch-info h4 { font-weight:800; font-size:0.95rem; }
.ch-info small { color:var(--wa); font-size:0.75rem; font-weight:600; }
.ch-actions { margin-left:auto; display:flex; gap:8px; }

.chat-messages {
  flex:1; overflow-y:auto; padding:20px; display:flex; flex-direction:column; gap:8px;
  position:relative; z-index:1;
}
.chat-messages::-webkit-scrollbar { width:4px; }
.chat-messages::-webkit-scrollbar-thumb { background:rgba(255,255,255,0.1); border-radius:2px; }

/* Message bubbles */
.msg { display:flex; max-width:75%; }
.msg.in { align-self:flex-start; }
.msg.out { align-self:flex-end; flex-direction:row-reverse; }

.msg-bubble {
  padding:8px 12px; border-radius:10px;
  font-size:0.85rem; line-height:1.45; position:relative;
  max-width:100%;
}
.msg.in .msg-bubble {
  background:#202C33; border-top-left-radius:2px; color:var(--text);
}
.msg.out .msg-bubble {
  background:#005C4B; border-top-right-radius:2px; color:var(--text);
}
.msg-time {
  font-size:0.65rem; color:rgba(255,255,255,0.45);
  display:block; text-align:right; margin-top:3px;
}
.msg-status { color:var(--wa); font-size:0.75rem; }
.msg-order-card {
  background:rgba(255,255,255,0.05);
  border:1px solid rgba(255,255,255,0.1);
  border-radius:8px; padding:10px; margin-top:6px;
  font-size:0.8rem;
}
.msg-order-card strong { color:var(--accent); display:block; margin-bottom:4px; }

.date-separator {
  text-align:center; font-size:0.72rem; color:var(--muted);
  background:rgba(255,255,255,0.06); padding:4px 14px;
  border-radius:20px; align-self:center; margin:8px 0;
}

/* Input area */
.chat-input-area {
  background:rgba(37,211,102,0.05); border-top:1px solid rgba(37,211,102,0.15);
  padding:14px 20px; display:flex; align-items:center; gap:10px; position:relative; z-index:1;
}
.chat-inp {
  flex:1; background:#202C33;
  border:none; border-radius:24px;
  padding:10px 18px; color:var(--text);
  font-family:'Nunito',sans-serif; font-size:0.88rem; outline:none;
}
.chat-inp::placeholder { color:var(--muted); }
.send-btn {
  background:var(--wa); border:none;
  width:44px; height:44px; border-radius:50%;
  color:white; font-size:1.2rem; cursor:pointer;
  display:flex; align-items:center; justify-content:center;
  transition:all 0.2s;
}
.send-btn:hover { background:var(--wa-dark); transform:scale(1.05); }
.template-btn {
  background:var(--bg3); border:1px solid var(--border);
  width:36px; height:36px; border-radius:50%; cursor:pointer;
  color:var(--text-muted); font-size:1rem;
  display:flex; align-items:center; justify-content:center; transition:all 0.2s;
}
.template-btn:hover { border-color:var(--wa); color:var(--wa); }

/* ‚îÄ‚îÄ TEMPLATES / RIGHT PANEL ‚îÄ‚îÄ */
.right-panel {
  background:var(--bg2); border-left:1px solid var(--border);
  display:flex; flex-direction:column; overflow:hidden;
}
.rp-header { padding:16px; border-bottom:1px solid var(--border); }
.rp-header h3 { font-weight:800; font-size:0.95rem; }
.rp-tabs { display:flex; border-bottom:1px solid var(--border); }
.rp-tab {
  flex:1; padding:10px; text-align:center;
  font-weight:700; font-size:0.75rem; cursor:pointer;
  border-bottom:2px solid transparent; transition:all 0.2s; color:var(--muted);
}
.rp-tab.active { color:var(--primary); border-bottom-color:var(--primary); }

.rp-content { flex:1; overflow-y:auto; padding:14px; }

/* Template cards */
.template-card {
  background:var(--bg3); border:1px solid var(--border); border-radius:10px;
  padding:14px; margin-bottom:10px; cursor:pointer; transition:all 0.2s;
}
.template-card:hover { border-color:var(--wa); }
.tc-label { font-size:0.7rem; font-weight:800; text-transform:uppercase; letter-spacing:0.5px; color:var(--muted); margin-bottom:6px; }
.tc-title { font-weight:800; font-size:0.9rem; margin-bottom:6px; color:var(--accent); }
.tc-preview { font-size:0.78rem; color:var(--muted); line-height:1.4; }
.tc-use {
  margin-top:10px; width:100%;
  background:rgba(37,211,102,0.15); border:1px solid var(--wa);
  color:var(--wa); border-radius:6px; padding:6px;
  font-family:'Nunito',sans-serif; font-weight:700; font-size:0.78rem; cursor:pointer;
  transition:all 0.2s;
}
.tc-use:hover { background:var(--wa); color:white; }

/* Stats */
.stat-card {
  background:var(--bg3); border:1px solid var(--border); border-radius:10px;
  padding:14px; margin-bottom:10px;
}
.stat-card .sc-val { font-size:1.8rem; font-weight:900; color:var(--wa); }
.stat-card .sc-label { font-size:0.78rem; color:var(--muted); font-weight:700; }

/* Quick actions */
.quick-actions { display:flex; flex-direction:column; gap:8px; }
.qa-btn {
  width:100%; background:var(--bg3); border:1px solid var(--border);
  color:var(--text); border-radius:8px; padding:10px 14px;
  font-family:'Nunito',sans-serif; font-weight:700; font-size:0.82rem;
  cursor:pointer; text-align:left; transition:all 0.2s;
  display:flex; align-items:center; gap:10px;
}
.qa-btn:hover { border-color:var(--wa); color:var(--wa); }

/* Modal de template */
.template-modal {
  display:none; position:fixed; inset:0; z-index:300;
  align-items:center; justify-content:center;
}
.template-modal.open { display:flex; }
.tm-overlay { position:absolute; inset:0; background:rgba(0,0,0,0.7); backdrop-filter:blur(4px); }
.tm-box {
  background:var(--card); border:1px solid var(--border); border-radius:16px;
  padding:28px; max-width:520px; width:90%; position:relative; z-index:1;
  animation:popIn 0.3s cubic-bezier(0.34,1.56,0.64,1);
}
@keyframes popIn { from{transform:scale(0.8);opacity:0} to{transform:scale(1);opacity:1} }
.tm-box h3 { font-family:'Abril Fatface',serif; color:var(--wa); margin-bottom:16px; font-size:1.2rem; }
.tm-textarea {
  width:100%; background:var(--bg3); border:1px solid var(--border);
  border-radius:8px; padding:12px; color:var(--text);
  font-family:'Nunito',sans-serif; font-size:0.88rem; outline:none;
  resize:none; min-height:200px; line-height:1.5; margin-bottom:14px;
}
.tm-textarea:focus { border-color:var(--wa); }
.tm-actions { display:flex; gap:10px; justify-content:flex-end; }
.btn { padding:9px 20px; border-radius:8px; border:none; font-family:'Nunito',sans-serif; font-weight:800; font-size:0.85rem; cursor:pointer; transition:all 0.2s; }
.btn-wa { background:linear-gradient(135deg,var(--wa),var(--wa-dark)); color:white; }
.btn-wa:hover { transform:translateY(-2px); box-shadow:0 6px 20px rgba(37,211,102,0.4); }
.btn-sec { background:var(--bg3); color:var(--text); border:1px solid var(--border); }

/* Toast */
.toast { position:fixed; bottom:20px; right:20px; background:var(--wa); color:white; padding:12px 20px; border-radius:10px; font-weight:700; font-size:0.88rem; transform:translateY(80px); opacity:0; transition:all 0.4s cubic-bezier(0.34,1.56,0.64,1); z-index:500; }
.toast.show { transform:translateY(0); opacity:1; }
</style>
</head>
<body>

<!-- TOP BAR -->
<div class="topbar">
  <div class="topbar-brand">
    <span style="font-size:1.8rem">üí¨</span>
    <div>
      <h1>Central WhatsApp</h1>
      <small>PizzaMaster Pro ‚Äî Comunica√ß√£o com Clientes</small>
    </div>
  </div>
  <div class="wa-status">
    <div class="wa-dot"></div>
    <span class="wa-status-text">API Conectada</span>
    <span style="font-size:0.75rem;color:var(--muted);margin-left:16px">12 mensagens hoje</span>
  </div>
</div>

<div class="layout">

  <!-- CONTACTS PANEL -->
  <div class="contacts-panel">
    <div class="cp-header">
      <h3>üí¨ Conversas</h3>
      <input class="cp-search" type="text" placeholder="Buscar contato..." oninput="filterContacts(this.value)">
    </div>
    <div class="cp-tabs">
      <div class="cp-tab active" onclick="filterTab('all',this)">Todas</div>
      <div class="cp-tab" onclick="filterTab('nao_lido',this)">N√£o lidas</div>
      <div class="cp-tab" onclick="filterTab('pedido',this)">Pedidos</div>
    </div>
    <div class="contacts-list" id="contactsList"></div>
  </div>

  <!-- CHAT PANEL -->
  <div class="chat-panel">
    <div class="chat-header" id="chatHeader">
      <span style="font-size:2rem">üí¨</span>
      <div>
        <h4>Selecione uma conversa</h4>
        <small>Clique em um contato √† esquerda</small>
      </div>
    </div>
    <div class="chat-messages" id="chatMessages">
      <div style="text-align:center;margin:auto;color:var(--muted);padding:40px">
        <div style="font-size:3rem;margin-bottom:12px">üí¨</div>
        <p>Selecione uma conversa para come√ßar</p>
      </div>
    </div>
    <div class="chat-input-area">
      <button class="template-btn" onclick="openTemplateModal()" title="Templates">üìã</button>
      <input class="chat-inp" type="text" placeholder="Digite uma mensagem..." id="chatInput" onkeypress="handleKey(event)">
      <button class="send-btn" onclick="sendMessage()">‚û§</button>
    </div>
  </div>

  <!-- RIGHT PANEL -->
  <div class="right-panel">
    <div class="rp-header"><h3>üöÄ Ferramentas</h3></div>
    <div class="rp-tabs">
      <div class="rp-tab active" onclick="setRpTab('templates',this)">Templates</div>
      <div class="rp-tab" onclick="setRpTab('stats',this)">Estat√≠sticas</div>
      <div class="rp-tab" onclick="setRpTab('acoes',this)">A√ß√µes</div>
    </div>
    <div class="rp-content" id="rpContent"></div>
  </div>

</div>

<!-- TEMPLATE MODAL -->
<div class="template-modal" id="templateModal">
  <div class="tm-overlay" onclick="closeTemplateModal()"></div>
  <div class="tm-box">
    <h3>üìã Editar Mensagem</h3>
    <textarea class="tm-textarea" id="tmTextarea"></textarea>
    <div class="tm-actions">
      <button class="btn btn-sec" onclick="closeTemplateModal()">Cancelar</button>
      <button class="btn btn-wa" onclick="usarTemplate()">üí¨ Enviar pelo WhatsApp</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ‚îÄ‚îÄ DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const NUMERO_LOJA = '5511999999999';

const contacts = [
  { id:1, nome:'Carlos Silva', tel:'(11) 98765-4321', telRaw:'5511987654321', avatar:'CS', color:'#FF4500', unread:2,
    pedido:'#0021', status:'aberto', lastMsg:'Meu pedido j√° saiu?', lastTime:'18:58',
    msgs:[
      { dir:'in', text:'Oi! Fiz um pedido h√° 30 min, est√° tudo ok?', time:'18:30' },
      { dir:'out', text:'Ol√° Carlos! Tudo certo, seu pedido #0021 est√° sendo preparado com carinho! üçï', time:'18:31', status:'‚úì‚úì' },
      { dir:'in', text:'Que bom! Que pizzas est√£o no pedido mesmo?', time:'18:45' },
      { dir:'out', text:'Seu pedido cont√©m:\nüçï Margherita G\nü´í Portuguesa M\nü•§ 2x Coca-Cola\n\nTotal: R$ 123,60 üí∞', time:'18:46', status:'‚úì‚úì' },
      { dir:'in', text:'Meu pedido j√° saiu?', time:'18:58' },
    ]},
  { id:2, nome:'Ana Costa', tel:'(11) 97654-3210', telRaw:'5511976543210', avatar:'AC', color:'#9C27B0', unread:0,
    pedido:'#0022', status:'enviado', lastMsg:'Obrigada! Chegou certinho üòç', lastTime:'18:20',
    msgs:[
      { dir:'out', text:'Ol√° Ana! Seu pedido #0022 foi confirmado! üçï\n2x Pepperoni M\nTotal: R$ 89,80\n\nRetirada no local, j√° pode vir!', time:'17:55', status:'‚úì‚úì' },
      { dir:'in', text:'Obrigada! Estou chegando em 10 min', time:'18:10' },
      { dir:'out', text:'Perfeito! Estaremos te esperando üòä', time:'18:11', status:'‚úì‚úì' },
      { dir:'in', text:'Obrigada! Chegou certinho üòç', time:'18:20' },
    ]},
  { id:3, nome:'Jo√£o Ferreira', tel:'(11) 96543-2109', telRaw:'5511965432109', avatar:'JF', color:'#2196F3', unread:1,
    pedido:'#0023', status:'entregue', lastMsg:'Qual o tempo de entrega?', lastTime:'19:05',
    msgs:[
      { dir:'in', text:'Boa noite! Quero fazer um pedido', time:'18:10' },
      { dir:'out', text:'Boa noite Jo√£o! Seja bem-vindo √† PizzaMaster Pro! üçï\n\nNosso card√°pio completo est√° dispon√≠vel em:\ncardapio.pizzamaster.com\n\nOu me diga o que deseja e eu anoto!', time:'18:11', status:'‚úì‚úì' },
      { dir:'in', text:'Quero Quatro Queijos G e Frango M, entrega', time:'18:20' },
      { dir:'out', text:'Pedido anotado! ‚úÖ\nüßÄ Quatro Queijos G ‚Äî R$ 62,90\nüêî Frango c/ Catupiry M ‚Äî R$ 44,90\nüõµ Taxa entrega ‚Äî R$ 5,00\nüí∞ Total: R$ 112,80\n\nPagamento: Dinheiro (troco para R$200)\n\nEstimativa: 40-50 min üïê', time:'18:21', status:'‚úì‚úì' },
      { dir:'in', text:'Qual o tempo de entrega?', time:'19:05' },
    ]},
  { id:4, nome:'Maria Oliveira', tel:'(11) 95432-1098', telRaw:'5511954321098', avatar:'MO', color:'#E91E63', unread:0,
    pedido:'#0024', status:'entregue', lastMsg:'Perfeito, obrigada!', lastTime:'17:50',
    msgs:[
      { dir:'out', text:'üéÇ FELIZ ANIVERS√ÅRIO, MARIA! üéâ\n\nA PizzaMaster Pro tem um presente especial para voc√™:\n\nüçï 10% de desconto no seu pr√≥ximo pedido!\n\nC√≥digo: ANIVERSARIO10\n\nAproveite! üòç', time:'17:30', status:'‚úì‚úì' },
      { dir:'in', text:'Ai que fofo!! Obrigada demais!', time:'17:45' },
      { dir:'in', text:'Perfeito, obrigada!', time:'17:50' },
    ]},
  { id:5, nome:'Pedro Santos', tel:'(11) 94321-0987', telRaw:'5511943210987', avatar:'PS', color:'#00BCD4', unread:3,
    pedido:'#0025', status:'aberto', lastMsg:'A pizza t√° demorando muito', lastTime:'19:15',
    msgs:[
      { dir:'in', text:'Oi, fiz um pedido na mesa 4', time:'19:02' },
      { dir:'out', text:'Ol√° Pedro! Pedido recebido ‚úÖ\nSua Mexicana G + Frango M + 3 Sucos est√£o sendo preparados!\nEstimativa: 20 min üçï', time:'19:03', status:'‚úì' },
      { dir:'in', text:'T√° bom', time:'19:05' },
      { dir:'in', text:'A pizza t√° demorando muito', time:'19:15' },
    ]},
];

const TEMPLATES = [
  { cat:'Pedido', titulo:'‚úÖ Confirma√ß√£o de Pedido', preview:'Seu pedido foi confirmado e est√° sendo preparado...', texto:`‚úÖ *Pedido Confirmado!*\n\nOl√°, {nome}! üçï\n\nSeu pedido *{pedido}* foi confirmado:\n{itens}\n\nüí∞ *Total: {total}*\n‚è±Ô∏è Tempo estimado: 40‚Äì50 min\n\nAcompanhe pelo WhatsApp!\n\n_PizzaMaster Pro_ üçï` },
  { cat:'Pedido', titulo:'üî• Pedido em Preparo', preview:'Sua pizza est√° sendo preparada com muito carinho!', texto:`üî• *Not√≠cia quente!* (literalmente)\n\nOl√°, {nome}! üëã\n\nSeu pedido *{pedido}* est√° no forno agora! üçï\n\nEstamos preparando tudo com muito carinho para voc√™.\n\n*Previs√£o de sa√≠da: 15 minutos* ‚è±Ô∏è\n\n_PizzaMaster Pro_ üçï` },
  { cat:'Pedido', titulo:'üõµ Saiu para Entrega', preview:'Seu pedido est√° a caminho!', texto:`üõµ *Seu pedido est√° a caminho!*\n\nOl√°, {nome}! üòä\n\nSeu pedido *{pedido}* acabou de sair para entrega!\n\nüìç Endere√ßo: {endereco}\n‚è±Ô∏è Previs√£o de chegada: 20‚Äì30 min\n\nFique de olho, estamos chegando! üçï\n\n_PizzaMaster Pro_ üçï` },
  { cat:'Pedido', titulo:'‚úÖ Pedido Entregue', preview:'Sua pizza foi entregue! Avalie nosso atendimento.', texto:`‚úÖ *Pedido Entregue com Sucesso!*\n\nOl√°, {nome}! üéâ\n\nEsperamos que esteja delicioso! üòã\n\n‚≠ê *Deixe sua avalia√ß√£o:*\nhttps://g.page/pizzamaster\n\nAt√© o pr√≥ximo pedido! üçï\n\n_Obrigado pela prefer√™ncia!_\n_PizzaMaster Pro_ üçï` },
  { cat:'Marketing', titulo:'üéÅ Oferta Especial', preview:'Promo√ß√£o exclusiva para clientes especiais!', texto:`üéÅ *OFERTA ESPECIAL PARA VOC√ä!*\n\nOl√°, {nome}! üëã\n\nüçï *PIZZAS A PARTIR DE R$ 29,90!*\n\n‚úÖ V√°lido somente hoje!\n‚úÖ Entrega gr√°tis acima de R$ 80\n‚úÖ Use o c√≥digo: *PROMO10*\n\nFa√ßa seu pedido agora:\nüì± (11) 9999-9999\n\n_PizzaMaster Pro ‚Äî A melhor pizza da cidade!_ üçï` },
  { cat:'Marketing', titulo:'üéÇ Anivers√°rio', preview:'Mensagem especial de anivers√°rio com desconto!', texto:`üéÇ *FELIZ ANIVERS√ÅRIO, {nome}!* üéâ\n\nToda a equipe da PizzaMaster Pro deseja um dia incr√≠vel!\n\nüéÅ *Presente especial:*\n10% de desconto no seu pr√≥ximo pedido!\n\n*C√≥digo: ANIVERSARIO10*\n\nV√°lido por 7 dias. Aproveite! üçï\n\n_Com carinho, PizzaMaster Pro_ üçï` },
  { cat:'Marketing', titulo:'üì£ Card√°pio Novo', preview:'Novidades no card√°pio! Confira as novidades.', texto:`üì£ *NOVIDADES NO CARD√ÅPIO!* üçï\n\nOl√°, {nome}! üéâ\n\nTemos novidades incr√≠veis esperando por voc√™:\n\n‚≠ê *Pizza Mexicana Premium* ‚Äî R$ 66,90\n‚≠ê *Trufa c/ Nozes* ‚Äî R$ 78,90\n‚≠ê *Nutella c/ Morango* ‚Äî R$ 59,90\n\nüõµ Entrega: R$ 5,00\n‚è±Ô∏è 40‚Äì50 min\n\nPe√ßa agora! üì± (11) 9999-9999\n\n_PizzaMaster Pro_ üçï` },
  { cat:'Atendimento', titulo:'‚è∞ Aviso de Demora', preview:'Pedido com pequeno atraso, pedimos desculpas.', texto:`‚è∞ *Aviso Importante*\n\nOl√°, {nome}!\n\nEstamos com alto volume de pedidos agora e seu pedido *{pedido}* pode ter um pequeno atraso de aproximadamente *15 minutos.*\n\nPedimos sinceras desculpas! üôè\n\nComo compensa√ß√£o, na sua *pr√≥xima compra* voc√™ ter√° *desconto de 10%.*\n\nObrigado pela compreens√£o! üòä\n\n_PizzaMaster Pro_ üçï` },
  { cat:'Atendimento', titulo:'‚ùå Cancelamento', preview:'Infelizmente precisamos cancelar o pedido.', texto:`‚ùå *Sobre seu Pedido {pedido}*\n\nOl√°, {nome}!\n\nInfelizmente precisamos cancelar seu pedido por: *{motivo}.*\n\nO estorno ser√° processado em at√© 5 dias √∫teis.\n\nMuito obrigado pela compreens√£o e esperamos te atender em breve! üôè\n\n_PizzaMaster Pro_ üçï` },
];

// ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let currentContact = null;
let currentRpTab = 'templates';
let currentTemplate = '';

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.addEventListener('DOMContentLoaded', () => {
  renderContacts(contacts);
  setRpTab('templates', document.querySelector('.rp-tab.active'));
});

// ‚îÄ‚îÄ CONTACTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderContacts(list) {
  document.getElementById('contactsList').innerHTML = list.map(c => `
    <div class="contact-item ${currentContact?.id===c.id?'active':''}" onclick="selectContact(${c.id})">
      <div class="ca-avatar" style="background:${c.color}20;color:${c.color}">${c.avatar}</div>
      <div class="ca-info">
        <div class="ca-name">${c.nome}</div>
        <div class="ca-last">${c.lastMsg}</div>
      </div>
      <div class="ca-meta">
        <span class="ca-time">${c.lastTime}</span>
        ${c.unread>0?`<span class="ca-badge">${c.unread}</span>`:`<span class="ca-status status-${c.status}">${{enviado:'Enviado',entregue:'Entregue',aberto:'Aberto'}[c.status]||c.status}</span>`}
      </div>
    </div>
  `).join('');
}

function filterContacts(q) {
  renderContacts(contacts.filter(c => c.nome.toLowerCase().includes(q.toLowerCase()) || c.tel.includes(q)));
}

function filterTab(tab, el) {
  document.querySelectorAll('.cp-tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  if (tab === 'all') renderContacts(contacts);
  else if (tab === 'nao_lido') renderContacts(contacts.filter(c => c.unread > 0));
  else renderContacts(contacts.filter(c => c.pedido));
}

function selectContact(id) {
  currentContact = contacts.find(c => c.id === id);
  currentContact.unread = 0;
  renderContacts(contacts);
  renderChat();
}

// ‚îÄ‚îÄ CHAT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderChat() {
  if (!currentContact) return;
  const c = currentContact;

  document.getElementById('chatHeader').innerHTML = `
    <div class="ch-avatar" style="background:${c.color}25;color:${c.color}">${c.avatar}</div>
    <div class="ch-info">
      <h4>${c.nome}</h4>
      <small>üü¢ Online ‚Ä¢ ${c.tel} ‚Ä¢ Pedido: ${c.pedido}</small>
    </div>
    <div class="ch-actions">
      <button class="btn" style="background:rgba(37,211,102,0.15);color:var(--wa);border:1px solid var(--wa);padding:7px 14px;font-size:0.8rem" onclick="openWa('${c.telRaw}')">üì≤ Abrir WhatsApp</button>
      <button class="btn" style="background:var(--bg3);color:var(--text);border:1px solid var(--border);padding:7px 14px;font-size:0.8rem" onclick="openTemplateModal()">üìã Templates</button>
    </div>
  `;

  const msgs = document.getElementById('chatMessages');
  msgs.innerHTML = `<div class="date-separator">üìÖ Hoje</div>` +
    c.msgs.map(m => `
    <div class="msg ${m.dir}">
      <div class="msg-bubble">
        ${m.text.replace(/\n/g,'<br>').replace(/\*(.*?)\*/g,'<strong>$1</strong>')}
        <span class="msg-time">${m.time} ${m.dir==='out'?`<span class="msg-status">${m.status||'‚úì'}</span>`:''}</span>
      </div>
    </div>
  `).join('');

  msgs.scrollTop = msgs.scrollHeight;
}

function handleKey(e) { if (e.key === 'Enter') sendMessage(); }

function sendMessage() {
  const inp = document.getElementById('chatInput');
  const text = inp.value.trim();
  if (!text || !currentContact) return;

  const msg = { dir:'out', text, time: new Date().toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'}), status:'‚úì' };
  currentContact.msgs.push(msg);
  currentContact.lastMsg = text;
  currentContact.lastTime = msg.time;
  inp.value = '';
  renderChat();
  renderContacts(contacts);
  showToast('‚úÖ Mensagem enviada!');
}

// ‚îÄ‚îÄ TEMPLATES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openTemplateModal(texto = '') {
  currentTemplate = texto || (currentContact ? `Ol√°, ${currentContact.nome}! üòä\n\n` : '');
  document.getElementById('tmTextarea').value = currentTemplate;
  document.getElementById('templateModal').classList.add('open');
}
function closeTemplateModal() { document.getElementById('templateModal').classList.remove('open'); }

function useTemplate(index) {
  const t = TEMPLATES[index];
  let msg = t.texto;
  if (currentContact) {
    msg = msg.replace(/{nome}/g, currentContact.nome.split(' ')[0]);
    msg = msg.replace(/{pedido}/g, currentContact.pedido || '#0000');
    msg = msg.replace(/{endereco}/g, 'endere√ßo do cliente');
    msg = msg.replace(/{itens}/g, '‚Ä¢ Itens do pedido');
    msg = msg.replace(/{total}/g, 'R$ 0,00');
    msg = msg.replace(/{motivo}/g, 'indisponibilidade do produto');
  }
  openTemplateModal(msg);
}

function usarTemplate() {
  const text = document.getElementById('tmTextarea').value.trim();
  if (!text) return;
  if (currentContact) {
    const url = `https://wa.me/${currentContact.telRaw}?text=${encodeURIComponent(text)}`;
    window.open(url, '_blank');
    closeTemplateModal();
    showToast('üí¨ Abrindo WhatsApp...');
  } else {
    closeTemplateModal();
    showToast('Selecione um contato primeiro!', true);
  }
}

function openWa(tel) {
  window.open(`https://wa.me/${tel}`, '_blank');
}

// ‚îÄ‚îÄ A√á√ïES R√ÅPIDAS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function sendStatusUpdate(status) {
  if (!currentContact) { showToast('Selecione um contato primeiro!', true); return; }
  const tmplMap = { confirmado:0, preparo:1, entrega:2, entregue:3 };
  useTemplate(tmplMap[status]);
}

function sendBulkMsg() {
  const msg = encodeURIComponent(`üçï *PizzaMaster Pro ‚Äî Novidade!*\n\nConfira nossas ofertas especiais de hoje!\n\nüõµ Entrega gr√°tis acima de R$ 80\n‚è±Ô∏è 40-50 min\n\nPe√ßa agora: (11) 9999-9999`);
  window.open(`https://wa.me/?text=${msg}`, '_blank');
}

// ‚îÄ‚îÄ RIGHT PANEL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setRpTab(tab, el) {
  currentRpTab = tab;
  document.querySelectorAll('.rp-tab').forEach(t => t.classList.remove('active'));
  el?.classList.add('active');

  const content = document.getElementById('rpContent');

  if (tab === 'templates') {
    const cats = [...new Set(TEMPLATES.map(t => t.cat))];
    content.innerHTML = cats.map(cat => `
      <div style="font-size:0.7rem;font-weight:800;text-transform:uppercase;color:var(--muted);margin:12px 0 6px;letter-spacing:0.5px">${cat}</div>
      ${TEMPLATES.filter(t=>t.cat===cat).map((t,i) => {
        const idx = TEMPLATES.indexOf(t);
        return `<div class="template-card">
          <div class="tc-label">${t.cat}</div>
          <div class="tc-title">${t.titulo}</div>
          <div class="tc-preview">${t.preview}</div>
          <button class="tc-use" onclick="useTemplate(${idx})">üìã Usar Template</button>
        </div>`;
      }).join('')}
    `).join('');
  }

  else if (tab === 'stats') {
    content.innerHTML = `
      <div class="stat-card"><div class="sc-val">47</div><div class="sc-label">Mensagens Enviadas Hoje</div></div>
      <div class="stat-card"><div class="sc-val">5</div><div class="sc-label">Pedidos via WhatsApp</div></div>
      <div class="stat-card"><div class="sc-val">98%</div><div class="sc-label">Taxa de Entrega (msg)</div></div>
      <div class="stat-card"><div class="sc-val">4min</div><div class="sc-label">Tempo M√©dio de Resposta</div></div>
      <div class="stat-card"><div class="sc-val">R$ 1.240</div><div class="sc-label">Vendas via WhatsApp Hoje</div></div>
      <div style="font-size:0.75rem;color:var(--muted);margin-top:12px;text-align:center">
        üí° Para automa√ß√£o avan√ßada, integre com a<br><strong style="color:var(--wa)">WhatsApp Business API</strong> oficial.
      </div>
    `;
  }

  else if (tab === 'acoes') {
    content.innerHTML = `
      <div style="font-size:0.82rem;color:var(--muted);margin-bottom:14px">A√ß√µes r√°pidas para o pedido selecionado</div>
      <div class="quick-actions">
        <button class="qa-btn" onclick="sendStatusUpdate('confirmado')">‚úÖ Enviar Confirma√ß√£o de Pedido</button>
        <button class="qa-btn" onclick="sendStatusUpdate('preparo')">üî• Avisar que Est√° em Preparo</button>
        <button class="qa-btn" onclick="sendStatusUpdate('entrega')">üõµ Avisar que Saiu para Entrega</button>
        <button class="qa-btn" onclick="sendStatusUpdate('entregue')">‚≠ê Solicitar Avalia√ß√£o</button>
        <hr style="border-color:var(--border);margin:8px 0">
        <button class="qa-btn" onclick="useTemplate(4)">üéÅ Enviar Oferta Especial</button>
        <button class="qa-btn" onclick="useTemplate(5)">üéÇ Enviar Parab√©ns</button>
        <button class="qa-btn" onclick="useTemplate(6)">üì£ Divulgar Card√°pio Novo</button>
        <button class="qa-btn" onclick="useTemplate(7)">‚è∞ Avisar Demora</button>
        <hr style="border-color:var(--border);margin:8px 0">
        <button class="qa-btn" style="color:var(--wa);border-color:var(--wa)" onclick="sendBulkMsg()">üì¢ Enviar para M√∫ltiplos Clientes</button>
      </div>
    `;
  }
}

function showToast(msg, error=false) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.style.background = error ? '#FF1744' : 'var(--wa)';
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
}
</script>
</body>
</html>
